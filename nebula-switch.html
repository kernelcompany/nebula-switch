<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../nebula-element-mixin/nebula-element-mixin.html">
<link rel="import" href="../nebula-focus-behavior/nebula-focus-behavior.html">
<link rel="import" href="../nebula-checked-behavior/nebula-checked-behavior.html">
<link rel="import" href="../nebula-icons/nebula-icons.html">
<link rel="import" href="nebula-switch-icons.html">

<dom-module id="nebula-switch">
  <template>
    <style>
      :host {
        position: relative;
        display: inline-block;
        cursor: pointer;
        margin: var(--nebula-ui-margin, 4px);
        padding: 0;
        border: var(--nebula-ui-border-width, 0px) solid transparent;
        border-radius: var(--nebula-ui-border-radius, 2px);
        height: var(--nebula-switch-size, 1.5rem);
        width: calc(var(--nebula-switch-size, 1.5rem) * 2);
        color: var(--nebula-switch-color, dimgrey);
        outline: 0;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
      }
      #rail {
        position: absolute;
        top: 50%;
        left: 12px;
        right: 12px;
        transform: translateY(-50%);
        height: calc(var(--nebula-switch-size, 1.5rem) * 0.2);
        margin: 0;
        border: 0;
        border-radius: 2px;
        padding: 0;
        opacity: 0.6;
        background-color: currentColor;
        transition: background-color 0.25s linear;
      }
      #icon {
        position: absolute;
        width: var(--nebula-switch-size, 1.5rem);
        height: var(--nebula-switch-size, 1.5rem);
        margin: 0;
        left: 0;
        transform: translateX(0%);
        transition: transform 0.25s ease;
      }
      :host([checked]) {
        color: var(--nebula-switch-checked-color, inherit);
      }
      :host([checked]) #rail {
        background-color: currentColor;
      }
      :host([checked]) #icon {
        transform: translateX(100%);
      }
      :host([focused]) {
        box-shadow: var(--nebula-ui-focused-box-shadow, 0px 0px 1px 1px currentColor);
      }
      :host([hidden]) {
        display: none;
      }
      :host([disabled]) {
        pointer-events: none;
        cursor: default;   
        opacity: var(--nebula-ui-disabled-opacity, 0.6);
      }
    </style>
    <hr id="rail">
    <nebula-icon id="icon" icon="[[icon]]"></nebula-icon>
  </template>
  <script>
  (function() {
    'use strict'

    // symbols for private members
    const onTrack = Symbol()

    // symbols for protected members
    const listen = Symbol.for('Nebula.ElementMixin.listen')

    /**
     * A configurable switch control.
     */
    class NebulaSwitch extends Nebula.CheckedBehavior(Nebula.FocusBehavior(Nebula.ElementMixin(Polymer.Element))) {

      /**
       * Gets the custom element name.
       * @type {string}
       */
      static get is() { return 'nebula-switch' }

      /**
       * Gets the property definitions for data binding.
       * @type {Object}
       * @property {string} icon - The key of the icon resource to render.
       */
      static get properties() {
        return {
          icon: {
            type: String,
            value: 'nebula-switch:circle'
          }
        }
      }

      /**
       * Lifecycle callback invoked when element has been initialized.
       * @public
       */
      ready() {
        super.ready();
        this.setAttribute('role', 'checkbox')
        this[listen](this, 'track', this[onTrack])
      }

      /**
       * Event handler triggered on a touch swipe gesture.
       * @private
       */
      [onTrack](e) {
        e.preventDefault()
        if (e.detail.dx > 0) {
          this.set('checked', true)
        } else if (e.detail.dx < 0) {
          this.set('checked', false)
        }
      }

    }

    customElements.define(NebulaSwitch.is, NebulaSwitch)
  }())
  </script>
</dom-module>
