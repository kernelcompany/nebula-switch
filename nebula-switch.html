<!--
@license
Copyright (c) 2017 Ars Nebula LLC.
This code may be used under the terms found in LICENSE.md of this repository.
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-iconset-svg/iron-iconset-svg.html">
<link rel="import" href="../nebula-focus-behavior/nebula-focus-behavior.html">
<link rel="import" href="../nebula-checked-behavior/nebula-checked-behavior.html">

<!--
`<nebula-switch>` is a web component to display a switch control.

## Usage

The following demonstrates common properties and events.

```html
<nebula-switch
  checked="{{checked}}"
  on-change="_onChange">
</nebula-switch>
```

You can customize the icon, by specifying the name of an `iron-icon` in the icon registry. It is recommended you use an icon with a solid background.

```html
<nebula-switch
  icon="icons:favorite">
</nebula-switch>
```

## Style

Theme variables are used to style key design goals for the element and affect multiple styles (border, background color) across multiple states.

Custom property | Description
:--- | :---
`--nebula-switch-color` | The theme color of the element.
`--nebula-switch-checked-color` | The theme color of the element when checked.
`--nebula-switch-size` | The height and width of the element.

For more granular control, the following mixins can be used to style each state of the element:

Custom property | Description
:--- | :---
`--nebula-switch` | Mixin applied to base element.
`--nebula-switch-rail` | Mixin applied to element rail child element.
`--nebula-switch-icon` | Mixin applied to element icon child element.
`--nebula-switch-checked` | Mixin applied to element when checked.
`--nebula-switch-focused` | Mixin applied to element when focused.
`--nebula-switch-disabled` | Mixin applied to element when disabled.

The element also inherits default values from the following global theme styles. If a global theme variable has not been set, it will use the local default.

Custom property | Description | Default
:--- | :--- | :---
`--nebula-ui-primary-color | The theme color of the element when checked. | teal
`--nebula-ui-margin` | The margin of the element. | 4px
`--nebula-ui-border-width` | The border width of the element. | 0px
`--nebula-ui-border-radius` | The border-radius of the element. | 2px
`--nebula-ui-disabled-opacity` | Opacity of the element when disabled. | 0.6

@demo demo/index.html
-->

<dom-module id="nebula-switch">
  <template>
    <style>
      :host {
        --nebula-switch-default-checked-color: var(--nebula-ui-primary-color, teal);
        position: relative;
        display: inline-block;
        cursor: pointer;
        margin: var(--nebula-ui-margin, 4px);
        padding: 0;
        border: var(--nebula-ui-border-width, 0px) solid transparent;
        border-radius: var(--nebula-ui-border-radius, 2px);
        height: var(--nebula-switch-size, 1.5rem);
        width: calc(var(--nebula-switch-size, 1.5rem) * 2);
        color: var(--nebula-switch-color, inherit);
        outline: 0;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
      }
      #rail {
        position: absolute;
        top: 50%;
        left: 12px;
        right: 12px;
        transform: translateY(-50%);
        height: calc(var(--nebula-switch-size, 1.5rem) * 0.2);
        margin: 0;
        border: 0;
        border-radius: 2px;
        padding: 0;
        opacity: 0.6;
        background-color: currentColor;
        transition: background-color 0.25s linear;
        @apply --nebula-switch-rail;
      }
      #icon {
        position: absolute;
        width: var(--nebula-switch-size, 1.5rem);
        height: var(--nebula-switch-size, 1.5rem);
        left: 0;
        transform: translateX(0%);
        transition: transform 0.25s ease;
        @apply --nebula-switch-icon;
      }
      :host([checked]) #rail {
        background-color: currentColor;
      }
      :host([checked]) #icon {
        transform: translateX(100%);
      }
      :host([checked]) {
        color: var(--nebula-switch-checked-color, var(--nebula-switch-default-checked-color));
        @apply --nebula-switch-checked;
      }
      :host([focused]) {
        box-shadow: var(--nebula-ui-focused-box-shadow, 0px 0px 1px 1px currentColor);
        @apply --nebula-switch-focused;
      }
      :host([disabled]) {
        pointer-events: none;
        cursor: default;   
        opacity: var(--nebula-ui-disabled-opacity, 0.6);
      }
    </style>
    <iron-iconset-svg size="24" name="nebula-switch">
      <svg>
        <defs>
          <g id="circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"></path></g>
        </defs>
      </svg>
    </iron-iconset-svg>
    <hr id="rail">
    <iron-icon id="icon" icon="[[icon]]"></iron-icon>
  </template>
  <script>
    Polymer({
      /**
      * Event triggered when the checked value is changed.
      * @event change
      */
      is: 'nebula-switch',
      behaviors: [
        Nebula.FocusBehavior,
        Nebula.CheckedBehavior
      ],
      hostAttributes: {
        'role': 'checkbox'
      },
      properties: {
        /**
        * The default icon to display when the element is not checked.
        */
        icon: {
          type: String,
          value: 'nebula-switch:circle'
        }
      },
      listeners: {
        'track': '_onTrack'  
      },
      _onTrack: function(e) {
        e.preventDefault()
        if (e.detail.dx > 0) {
          this.set('checked', true)
        } else if (e.detail.dx < 0) {
          this.set('checked', false)
        }
      }
    })
  </script>
</dom-module>
